syntax = "proto3";

package pistachio.admin.v1;

import "pistachio/admin/v1/project.proto";
import "pistachio/admin/v1/tenant.proto";

// =============================================================================
// Pistachio Admin Service
// =============================================================================
// PistachioAdmin provides administrative operations for managing Pistachio projects and tenants.
// Requires service account authentication.
service PistachioAdmin {
  // CreateProject creates a new Pistachio project.
  //
  // Projects are the top-level container for apps, users, and resources.
  // Each project can have multiple apps across different platforms
  // that share the same user pool.
  //
  // Errors:
  // - INVALID_ARGUMENT: Invalid project_id format or display_name
  // - ALREADY_EXISTS: Project ID is already taken
  // - PERMISSION_DENIED: Insufficient permissions
  rpc CreateProject(CreateProjectRequest) returns (CreateProjectResponse);

  // GetProject retrieves a project by its ID.
  //
  // Returns the project details including its current state and resources.
  //
  // Errors:
  // - INVALID_ARGUMENT: Invalid project_id format
  // - NOT_FOUND: Project does not exist
  // - PERMISSION_DENIED: Insufficient permissions
  rpc GetProject(GetProjectRequest) returns (GetProjectResponse);

  // UpdateProject updates an existing project.
  //
  // Currently only the display_name can be updated.
  //
  // Errors:
  // - INVALID_ARGUMENT: Invalid project_id or display_name format
  // - NOT_FOUND: Project does not exist
  // - PERMISSION_DENIED: Insufficient permissions
  rpc UpdateProject(UpdateProjectRequest) returns (UpdateProjectResponse);

  // DeleteProject soft-deletes a project.
  //
  // The project will be marked as DELETED and will be permanently removed
  // after 30 days. During this period, the project can be restored.
  //
  // Errors:
  // - INVALID_ARGUMENT: Invalid project_id format
  // - NOT_FOUND: Project does not exist
  // - PERMISSION_DENIED: Insufficient permissions
  rpc DeleteProject(DeleteProjectRequest) returns (DeleteProjectResponse);

  // UndeleteProject restores a soft-deleted project.
  //
  // The project must be in the DELETED state and within the 30-day
  // grace period. The project will be restored to ACTIVE state.
  //
  // Errors:
  // - INVALID_ARGUMENT: Invalid project_id format
  // - NOT_FOUND: Project does not exist
  // - FAILED_PRECONDITION: Project is not in DELETED state
  // - PERMISSION_DENIED: Insufficient permissions
  rpc UndeleteProject(UndeleteProjectRequest) returns (UndeleteProjectResponse);

  // ListProjects lists all projects accessible to the service account.
  //
  // Results are paginated and can optionally include deleted projects.
  //
  // Errors:
  // - INVALID_ARGUMENT: Invalid page_size or page_token
  // - PERMISSION_DENIED: Insufficient permissions
  rpc ListProjects(ListProjectsRequest) returns (ListProjectsResponse);

  // SearchProjects searches for projects using full-text search.
  //
  // Provides advanced search capabilities including:
  // - Full-text search across project fields
  // - Field-specific queries (e.g., display_name:Production*)
  // - Boolean operators (AND, OR, NOT)
  // - Range queries for dates
  // - Flexible sorting and cursor-based pagination
  //
  // Errors:
  // - INVALID_ARGUMENT: Invalid search query or parameters
  // - PERMISSION_DENIED: Insufficient permissions
  rpc SearchProjects(SearchProjectsRequest) returns (SearchProjectsResponse);

  // GetAdminSdkConfig retrieves the Admin SDK configuration for a project.
  //
  // Returns configuration needed to initialize the Admin SDK, including
  // storage bucket URL and database URL.
  //
  // Errors:
  // - INVALID_ARGUMENT: Invalid project_id format
  // - NOT_FOUND: Project does not exist
  // - PERMISSION_DENIED: Insufficient permissions
  rpc GetAdminSdkConfig(GetAdminSdkConfigRequest) returns (GetAdminSdkConfigResponse);

  // =============================================================================
  // Tenant Operations
  // =============================================================================

  // CreateTenant creates a new tenant within a project.
  //
  // Tenants provide multi-tenant isolation within a project, allowing
  // each tenant to have its own user pool and authentication configuration.
  //
  // Errors:
  // - INVALID_ARGUMENT: Invalid project_id, tenant_id, or display_name format
  // - ALREADY_EXISTS: Tenant ID is already taken within this project
  // - NOT_FOUND: Project does not exist
  // - PERMISSION_DENIED: Insufficient permissions
  rpc CreateTenant(CreateTenantRequest) returns (CreateTenantResponse);

  // GetTenant retrieves a tenant by its ID.
  //
  // Returns the tenant details including its authentication configuration.
  //
  // Errors:
  // - INVALID_ARGUMENT: Invalid project_id or tenant_id format
  // - NOT_FOUND: Project or tenant does not exist
  // - PERMISSION_DENIED: Insufficient permissions
  rpc GetTenant(GetTenantRequest) returns (GetTenantResponse);

  // UpdateTenant updates an existing tenant.
  //
  // Updates the tenant's display name, authentication settings, or MFA configuration.
  //
  // Errors:
  // - INVALID_ARGUMENT: Invalid project_id, tenant_id, or field format
  // - NOT_FOUND: Project or tenant does not exist
  // - PERMISSION_DENIED: Insufficient permissions
  rpc UpdateTenant(UpdateTenantRequest) returns (UpdateTenantResponse);

  // DeleteTenant permanently deletes a tenant.
  //
  // This operation is irreversible. All users and data associated with
  // the tenant will be permanently deleted.
  //
  // Errors:
  // - INVALID_ARGUMENT: Invalid project_id or tenant_id format
  // - NOT_FOUND: Project or tenant does not exist
  // - PERMISSION_DENIED: Insufficient permissions
  rpc DeleteTenant(DeleteTenantRequest) returns (DeleteTenantResponse);

  // ListTenants lists all tenants within a project.
  //
  // Results are paginated and sorted by creation time by default.
  //
  // Errors:
  // - INVALID_ARGUMENT: Invalid project_id, page_size, or page_token
  // - NOT_FOUND: Project does not exist
  // - PERMISSION_DENIED: Insufficient permissions
  rpc ListTenants(ListTenantsRequest) returns (ListTenantsResponse);

  // SearchTenants searches for tenants within a project using full-text search.
  //
  // Provides advanced search capabilities including:
  // - Full-text search across tenant fields
  // - Field-specific queries (e.g., display_name:Production*)
  // - Boolean operators (AND, OR, NOT)
  // - Range queries for dates
  // - Flexible sorting and cursor-based pagination
  //
  // Errors:
  // - INVALID_ARGUMENT: Invalid project_id or search query
  // - NOT_FOUND: Project does not exist
  // - PERMISSION_DENIED: Insufficient permissions
  rpc SearchTenants(SearchTenantsRequest) returns (SearchTenantsResponse);
}
