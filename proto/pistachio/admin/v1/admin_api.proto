syntax = "proto3";

package pistachio.admin.v1;

import "pistachio/admin/v1/app.proto";
import "pistachio/admin/v1/auth_provider.proto";
import "pistachio/admin/v1/project.proto";
import "pistachio/admin/v1/tenant.proto";

// =============================================================================
// Pistachio Admin Service
// =============================================================================
// PistachioAdmin provides administrative operations for managing Pistachio projects and tenants.
// Requires service account authentication.
service PistachioAdmin {
  // CreateProject creates a new Pistachio project.
  //
  // Projects are the top-level container for apps, users, and resources.
  // Each project can have multiple apps across different platforms
  // that share the same user pool.
  //
  // Errors:
  // - INVALID_ARGUMENT: Invalid project_id format or display_name
  // - ALREADY_EXISTS: Project ID is already taken
  // - PERMISSION_DENIED: Insufficient permissions
  rpc CreateProject(CreateProjectRequest) returns (CreateProjectResponse);

  // GetProject retrieves a project by its ID.
  //
  // Returns the project details including its current state and resources.
  //
  // Errors:
  // - INVALID_ARGUMENT: Invalid project_id format
  // - NOT_FOUND: Project does not exist
  // - PERMISSION_DENIED: Insufficient permissions
  rpc GetProject(GetProjectRequest) returns (GetProjectResponse);

  // UpdateProject updates an existing project.
  //
  // Currently only the display_name can be updated.
  //
  // Errors:
  // - INVALID_ARGUMENT: Invalid project_id or display_name format
  // - NOT_FOUND: Project does not exist
  // - PERMISSION_DENIED: Insufficient permissions
  rpc UpdateProject(UpdateProjectRequest) returns (UpdateProjectResponse);

  // DeleteProject soft-deletes a project.
  //
  // The project will be marked as DELETED and will be permanently removed
  // after 30 days. During this period, the project can be restored.
  //
  // Errors:
  // - INVALID_ARGUMENT: Invalid project_id format
  // - NOT_FOUND: Project does not exist
  // - PERMISSION_DENIED: Insufficient permissions
  rpc DeleteProject(DeleteProjectRequest) returns (DeleteProjectResponse);

  // UndeleteProject restores a soft-deleted project.
  //
  // The project must be in the DELETED state and within the 30-day
  // grace period. The project will be restored to ACTIVE state.
  //
  // Errors:
  // - INVALID_ARGUMENT: Invalid project_id format
  // - NOT_FOUND: Project does not exist
  // - FAILED_PRECONDITION: Project is not in DELETED state
  // - PERMISSION_DENIED: Insufficient permissions
  rpc UndeleteProject(UndeleteProjectRequest) returns (UndeleteProjectResponse);

  // ListProjects lists all projects accessible to the service account.
  //
  // Results are paginated and can optionally include deleted projects.
  //
  // Errors:
  // - INVALID_ARGUMENT: Invalid page_size or page_token
  // - PERMISSION_DENIED: Insufficient permissions
  rpc ListProjects(ListProjectsRequest) returns (ListProjectsResponse);

  // SearchProjects searches for projects using full-text search.
  //
  // Provides advanced search capabilities including:
  // - Full-text search across project fields
  // - Field-specific queries (e.g., display_name:Production*)
  // - Boolean operators (AND, OR, NOT)
  // - Range queries for dates
  // - Flexible sorting and cursor-based pagination
  //
  // Errors:
  // - INVALID_ARGUMENT: Invalid search query or parameters
  // - PERMISSION_DENIED: Insufficient permissions
  rpc SearchProjects(SearchProjectsRequest) returns (SearchProjectsResponse);

  // GetAdminSdkConfig retrieves the Admin SDK configuration for a project.
  //
  // Returns configuration needed to initialize the Admin SDK, including
  // storage bucket URL and database URL.
  //
  // Errors:
  // - INVALID_ARGUMENT: Invalid project_id format
  // - NOT_FOUND: Project does not exist
  // - PERMISSION_DENIED: Insufficient permissions
  rpc GetAdminSdkConfig(GetAdminSdkConfigRequest) returns (GetAdminSdkConfigResponse);

  // =============================================================================
  // Tenant Operations
  // =============================================================================

  // CreateTenant creates a new tenant within a project.
  //
  // Tenants provide multi-tenant isolation within a project, allowing
  // each tenant to have its own user pool and authentication configuration.
  //
  // Errors:
  // - INVALID_ARGUMENT: Invalid project_id, tenant_id, or display_name format
  // - ALREADY_EXISTS: Tenant ID is already taken within this project
  // - NOT_FOUND: Project does not exist
  // - PERMISSION_DENIED: Insufficient permissions
  rpc CreateTenant(CreateTenantRequest) returns (CreateTenantResponse);

  // GetTenant retrieves a tenant by its ID.
  //
  // Returns the tenant details including its authentication configuration.
  //
  // Errors:
  // - INVALID_ARGUMENT: Invalid project_id or tenant_id format
  // - NOT_FOUND: Project or tenant does not exist
  // - PERMISSION_DENIED: Insufficient permissions
  rpc GetTenant(GetTenantRequest) returns (GetTenantResponse);

  // UpdateTenant updates an existing tenant.
  //
  // Updates the tenant's display name, authentication settings, or MFA configuration.
  //
  // Errors:
  // - INVALID_ARGUMENT: Invalid project_id, tenant_id, or field format
  // - NOT_FOUND: Project or tenant does not exist
  // - PERMISSION_DENIED: Insufficient permissions
  rpc UpdateTenant(UpdateTenantRequest) returns (UpdateTenantResponse);

  // DeleteTenant permanently deletes a tenant.
  //
  // This operation is irreversible. All users and data associated with
  // the tenant will be permanently deleted.
  //
  // Errors:
  // - INVALID_ARGUMENT: Invalid project_id or tenant_id format
  // - NOT_FOUND: Project or tenant does not exist
  // - PERMISSION_DENIED: Insufficient permissions
  rpc DeleteTenant(DeleteTenantRequest) returns (DeleteTenantResponse);

  // ListTenants lists all tenants within a project.
  //
  // Results are paginated and sorted by creation time by default.
  //
  // Errors:
  // - INVALID_ARGUMENT: Invalid project_id, page_size, or page_token
  // - NOT_FOUND: Project does not exist
  // - PERMISSION_DENIED: Insufficient permissions
  rpc ListTenants(ListTenantsRequest) returns (ListTenantsResponse);

  // SearchTenants searches for tenants within a project using full-text search.
  //
  // Provides advanced search capabilities including:
  // - Full-text search across tenant fields
  // - Field-specific queries (e.g., display_name:Production*)
  // - Boolean operators (AND, OR, NOT)
  // - Range queries for dates
  // - Flexible sorting and cursor-based pagination
  //
  // Errors:
  // - INVALID_ARGUMENT: Invalid project_id or search query
  // - NOT_FOUND: Project does not exist
  // - PERMISSION_DENIED: Insufficient permissions
  rpc SearchTenants(SearchTenantsRequest) returns (SearchTenantsResponse);

  // =============================================================================
  // Project Auth Provider Operations
  // =============================================================================

  // ListProjectAuthProviders lists all auth providers configured for a project.
  //
  // Returns all configured auth providers with their settings, ordered by
  // display_order.
  //
  // Errors:
  // - INVALID_ARGUMENT: Invalid project_id format
  // - NOT_FOUND: Project does not exist
  // - PERMISSION_DENIED: Insufficient permissions
  rpc ListProjectAuthProviders(ListProjectAuthProvidersRequest) returns (ListProjectAuthProvidersResponse);

  // GetProjectAuthProvider retrieves a specific auth provider for a project.
  //
  // Returns the provider configuration including enabled state and settings.
  //
  // Errors:
  // - INVALID_ARGUMENT: Invalid project_id or provider_id format
  // - NOT_FOUND: Project or provider does not exist
  // - PERMISSION_DENIED: Insufficient permissions
  rpc GetProjectAuthProvider(GetProjectAuthProviderRequest) returns (GetProjectAuthProviderResponse);

  // UpdateProjectAuthProvider creates or updates an auth provider for a project.
  //
  // This is an upsert operation: if the provider exists, it is updated;
  // otherwise, a new provider is created. Supports providers:
  // - pdpka: Passphrase-derived public key authentication
  // - anonymous: Anonymous/guest authentication
  // - google, apple, facebook, github: OAuth 2.0 social providers
  // - oidc:<name>: Generic OpenID Connect providers
  //
  // Errors:
  // - INVALID_ARGUMENT: Invalid project_id, provider_id, or config format
  // - NOT_FOUND: Project does not exist
  // - PERMISSION_DENIED: Insufficient permissions
  rpc UpdateProjectAuthProvider(UpdateProjectAuthProviderRequest) returns (UpdateProjectAuthProviderResponse);

  // DeleteProjectAuthProvider permanently removes an auth provider from a project.
  //
  // Deleting a provider will prevent users from authenticating with that
  // method. Existing users who only have this auth method will be locked out.
  //
  // Errors:
  // - INVALID_ARGUMENT: Invalid project_id or provider_id format
  // - NOT_FOUND: Project or provider does not exist
  // - PERMISSION_DENIED: Insufficient permissions
  rpc DeleteProjectAuthProvider(DeleteProjectAuthProviderRequest) returns (DeleteProjectAuthProviderResponse);

  // =============================================================================
  // Tenant Auth Provider Override Operations
  // =============================================================================

  // ListTenantAuthProviders lists tenant-level auth provider overrides.
  //
  // Returns only the overrides explicitly set for this tenant, not the
  // full effective configuration. Use GetEffectiveTenantAuthProviders
  // for the merged configuration.
  //
  // Errors:
  // - INVALID_ARGUMENT: Invalid project_id or tenant_id format
  // - NOT_FOUND: Project or tenant does not exist
  // - PERMISSION_DENIED: Insufficient permissions
  rpc ListTenantAuthProviders(ListTenantAuthProvidersRequest) returns (ListTenantAuthProvidersResponse);

  // UpdateTenantAuthProvider creates or updates a tenant-level auth provider override.
  //
  // Tenant overrides allow customizing auth provider settings per tenant.
  // Fields not set inherit from the project-level configuration.
  //
  // Errors:
  // - INVALID_ARGUMENT: Invalid project_id, tenant_id, or provider_id format
  // - NOT_FOUND: Project, tenant, or project-level provider does not exist
  // - PERMISSION_DENIED: Insufficient permissions
  rpc UpdateTenantAuthProvider(UpdateTenantAuthProviderRequest) returns (UpdateTenantAuthProviderResponse);

  // DeleteTenantAuthProvider removes a tenant-level auth provider override.
  //
  // After deletion, the tenant will inherit the project-level configuration
  // for this provider.
  //
  // Errors:
  // - INVALID_ARGUMENT: Invalid project_id, tenant_id, or provider_id format
  // - NOT_FOUND: Project, tenant, or override does not exist
  // - PERMISSION_DENIED: Insufficient permissions
  rpc DeleteTenantAuthProvider(DeleteTenantAuthProviderRequest) returns (DeleteTenantAuthProviderResponse);

  // GetEffectiveTenantAuthProviders retrieves the merged auth provider configuration.
  //
  // Returns the effective configuration for a tenant after applying
  // tenant-level overrides to project-level configuration. Each provider
  // includes a source indicator showing where the configuration originates.
  //
  // Errors:
  // - INVALID_ARGUMENT: Invalid project_id or tenant_id format
  // - NOT_FOUND: Project or tenant does not exist
  // - PERMISSION_DENIED: Insufficient permissions
  rpc GetEffectiveTenantAuthProviders(GetEffectiveTenantAuthProvidersRequest) returns (GetEffectiveTenantAuthProvidersResponse);

  // =============================================================================
  // App Operations
  // =============================================================================

  // CreateApp registers a new app in the project.
  //
  // API keys are auto-generated for each app.
  // Platform-specific configuration is provided via the oneof platform_config field.
  //
  // Errors:
  // - INVALID_ARGUMENT: Invalid project_id or platform config
  // - NOT_FOUND: Project does not exist
  // - ALREADY_EXISTS: App with same identifier exists in project
  // - PERMISSION_DENIED: Insufficient permissions
  rpc CreateApp(CreateAppRequest) returns (CreateAppResponse);

  // GetApp retrieves an app by ID.
  //
  // Errors:
  // - NOT_FOUND: App does not exist
  // - PERMISSION_DENIED: Insufficient permissions
  rpc GetApp(GetAppRequest) returns (GetAppResponse);

  // ListApps lists apps in a project.
  //
  // Results are paginated and sorted by creation time by default.
  //
  // Errors:
  // - INVALID_ARGUMENT: Invalid project_id, page_size, or page_token
  // - NOT_FOUND: Project does not exist
  // - PERMISSION_DENIED: Insufficient permissions
  rpc ListApps(ListAppsRequest) returns (ListAppsResponse);

  // SearchApps searches for apps within a project using full-text search.
  //
  // Provides advanced search capabilities including:
  // - Full-text search across app fields
  // - Field-specific queries (e.g., display_name:Production*, platform:IOS)
  // - Boolean operators (AND, OR, NOT)
  // - Range queries for dates
  // - Flexible sorting and cursor-based pagination
  //
  // Errors:
  // - INVALID_ARGUMENT: Invalid project_id or search query
  // - NOT_FOUND: Project does not exist
  // - PERMISSION_DENIED: Insufficient permissions
  rpc SearchApps(SearchAppsRequest) returns (SearchAppsResponse);

  // UpdateApp updates an app's mutable fields.
  //
  // Platform-specific fields can be updated via the oneof platform_config field.
  //
  // Errors:
  // - NOT_FOUND: App does not exist
  // - INVALID_ARGUMENT: Invalid update parameters
  // - PERMISSION_DENIED: Insufficient permissions
  rpc UpdateApp(UpdateAppRequest) returns (UpdateAppResponse);

  // DeleteApp schedules an app for deletion (soft delete).
  //
  // The app enters DELETED state and will be permanently removed after 30 days.
  //
  // Errors:
  // - NOT_FOUND: App does not exist
  // - PERMISSION_DENIED: Insufficient permissions
  rpc DeleteApp(DeleteAppRequest) returns (DeleteAppResponse);

  // UndeleteApp restores a soft-deleted app.
  //
  // Only works for apps in DELETED state.
  //
  // Errors:
  // - NOT_FOUND: App does not exist
  // - FAILED_PRECONDITION: App is not in DELETED state
  // - PERMISSION_DENIED: Insufficient permissions
  rpc UndeleteApp(UndeleteAppRequest) returns (UndeleteAppResponse);

  // GetAppConfig retrieves the SDK configuration for an app.
  //
  // Returns platform-specific configuration files:
  // - iOS: GoogleService-Info.plist
  // - Android: google-services.json
  // - macOS/Windows/Linux: pistachio-config.json
  // - Web: JavaScript config object
  //
  // Errors:
  // - NOT_FOUND: App does not exist
  // - PERMISSION_DENIED: Insufficient permissions
  rpc GetAppConfig(GetAppConfigRequest) returns (GetAppConfigResponse);
}
