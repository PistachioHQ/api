syntax = "proto3";

package pistachio.types.v1;

import "google/protobuf/timestamp.proto";

// ServiceAccount represents a service account for server-to-server authentication.
//
// Service accounts use key-based authentication and are used for administrative
// operations and backend integrations. Unlike users, service accounts don't have
// passwords and authenticate using cryptographic keys.
message ServiceAccount {
  // Resource name in the format:
  // "projects/{project_id}/serviceAccounts/{service_account_id}"
  string name = 1;

  // Unique service account identifier within the project.
  // System-generated if not provided during creation.
  // 4-128 characters, lowercase alphanumeric with hyphens.
  string service_account_id = 2;

  // Internal service account identifier.
  // 16 bytes encoded as 32 hex characters ending in '03'.
  string pistachio_id = 3;

  // Human-readable display name.
  // Max 256 characters.
  string display_name = 4;

  // Optional description of the service account's purpose.
  // Max 1000 characters.
  string description = 5;

  // Auto-generated email address for the service account.
  // Format: {service_account_id}@{project_id}.pistachiohq.iam.gserviceaccount.com
  string email = 6;

  // Whether the service account is disabled.
  // Disabled service accounts cannot authenticate.
  bool disabled = 7;

  // Timestamp when the service account was created.
  google.protobuf.Timestamp created_at = 8;

  // Timestamp when the service account was last updated.
  google.protobuf.Timestamp updated_at = 9;
}

// ServiceAccountKey represents a key for service account authentication.
//
// Keys are used to generate JWTs for authenticating as the service account.
// Each service account can have multiple active keys for key rotation.
message ServiceAccountKey {
  // Resource name in the format:
  // "projects/{project_id}/serviceAccounts/{service_account_id}/keys/{key_id}"
  string name = 1;

  // Unique key identifier.
  string key_id = 2;

  // The algorithm used for the key pair.
  KeyAlgorithm key_algorithm = 3;

  // How the key was created.
  KeyOrigin key_origin = 4;

  // The key becomes valid at this time.
  google.protobuf.Timestamp valid_after_time = 5;

  // The key expires at this time.
  // Not set if the key has no expiration.
  optional google.protobuf.Timestamp valid_before_time = 6;

  // Whether the key is disabled.
  bool disabled = 7;
}

// KeyAlgorithm specifies the cryptographic algorithm used for service account keys.
enum KeyAlgorithm {
  // Unspecified algorithm.
  KEY_ALGORITHM_UNSPECIFIED = 0;

  // RSA 2048-bit key.
  KEY_ALGORITHM_RSA_2048 = 1;

  // RSA 4096-bit key.
  KEY_ALGORITHM_RSA_4096 = 2;

  // Elliptic Curve P-256 key.
  KEY_ALGORITHM_EC_P256 = 3;

  // Elliptic Curve P-384 key.
  KEY_ALGORITHM_EC_P384 = 4;

  // Ed25519 key (EdDSA).
  // Recommended for new keys due to smaller signatures and faster verification.
  KEY_ALGORITHM_ED25519 = 5;
}

// KeyOrigin indicates how a service account key was created.
enum KeyOrigin {
  // Unspecified origin.
  KEY_ORIGIN_UNSPECIFIED = 0;

  // The key was generated by the Pistachio system.
  KEY_ORIGIN_SYSTEM_PROVIDED = 1;

  // The key was provided by the user.
  KEY_ORIGIN_USER_PROVIDED = 2;
}
