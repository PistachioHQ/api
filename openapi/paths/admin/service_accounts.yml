# Service Account Management Endpoints

# =============================================================================
# Service Account Collection Endpoints
# =============================================================================

serviceAccounts:
  get:
    operationId: listServiceAccounts
    summary: List service accounts
    description: |
      Lists all service accounts within a project.
      Results are paginated with cursor-based pagination.
    tags:
      - Service Accounts
    security:
      - ApiKeyAuth: []
        ServiceAccountAuth: []
    parameters:
      - name: projectId
        in: path
        description: The project ID that owns the service accounts
        required: true
        schema:
          type: string
          pattern: '^[a-z][a-z0-9-]{4,28}[a-z0-9]$'
      - $ref: '../../components/parameters/pagination.yml#/PageSize'
      - $ref: '../../components/parameters/pagination.yml#/Cursor'
      - $ref: '../../components/parameters/pagination.yml#/Sort'
    responses:
      '200':
        description: List of service accounts
        content:
          application/json:
            schema:
              $ref: '../../components/schemas/admin/service_account.yml#/ListServiceAccountsResponse'
      '400':
        description: Invalid pagination parameters
        content:
          application/json:
            schema:
              $ref: '../../components/schemas/error.yml#/ProblemDetails'
      '401':
        description: Invalid or missing credentials
        content:
          application/json:
            schema:
              $ref: '../../components/schemas/error.yml#/ProblemDetails'
      '403':
        description: Permission denied
        content:
          application/json:
            schema:
              $ref: '../../components/schemas/error.yml#/ProblemDetails'
      '404':
        description: Project not found
        content:
          application/json:
            schema:
              $ref: '../../components/schemas/error.yml#/ProblemDetails'
      '500':
        $ref: '../../components/responses/errors.yml#/InternalServerError'
      '503':
        $ref: '../../components/responses/errors.yml#/ServiceUnavailable'

  post:
    operationId: createServiceAccount
    summary: Create a service account
    description: |
      Creates a new service account within a project.
      The service account ID is system-generated if not provided.
    tags:
      - Service Accounts
    security:
      - ApiKeyAuth: []
        ServiceAccountAuth: []
    parameters:
      - name: projectId
        in: path
        description: The project ID that will own the service account
        required: true
        schema:
          type: string
          pattern: '^[a-z][a-z0-9-]{4,28}[a-z0-9]$'
    requestBody:
      description: Service account creation parameters
      required: true
      content:
        application/json:
          schema:
            $ref: '../../components/schemas/admin/service_account.yml#/CreateServiceAccountRequest'
    responses:
      '201':
        description: Service account created
        content:
          application/json:
            schema:
              $ref: '../../components/schemas/admin/service_account.yml#/CreateServiceAccountResponse'
      '400':
        description: Invalid service account ID format or display name
        content:
          application/json:
            schema:
              $ref: '../../components/schemas/error.yml#/ProblemDetails'
      '401':
        description: Invalid or missing credentials
        content:
          application/json:
            schema:
              $ref: '../../components/schemas/error.yml#/ProblemDetails'
      '403':
        description: Permission denied
        content:
          application/json:
            schema:
              $ref: '../../components/schemas/error.yml#/ProblemDetails'
      '404':
        description: Project not found
        content:
          application/json:
            schema:
              $ref: '../../components/schemas/error.yml#/ProblemDetails'
      '409':
        description: Service account ID already exists
        content:
          application/json:
            schema:
              $ref: '../../components/schemas/error.yml#/ProblemDetails'
      '500':
        $ref: '../../components/responses/errors.yml#/InternalServerError'
      '503':
        $ref: '../../components/responses/errors.yml#/ServiceUnavailable'

# =============================================================================
# Individual Service Account Endpoints
# =============================================================================

serviceAccountById:
  get:
    operationId: getServiceAccount
    summary: Get a service account
    description: |
      Retrieves a service account by ID.
      Returns the service account's metadata including display name and status.
    tags:
      - Service Accounts
    security:
      - ApiKeyAuth: []
        ServiceAccountAuth: []
    parameters:
      - name: projectId
        in: path
        description: The project ID that owns the service account
        required: true
        schema:
          type: string
          pattern: '^[a-z][a-z0-9-]{4,28}[a-z0-9]$'
      - name: id
        in: path
        description: The service account ID
        required: true
        schema:
          type: string
          pattern: '^[a-z][a-z0-9-]{2,126}[a-z0-9]$'
    responses:
      '200':
        description: Service account details
        content:
          application/json:
            schema:
              $ref: '../../components/schemas/admin/service_account.yml#/GetServiceAccountResponse'
      '400':
        description: Invalid projectId or service account ID format
        content:
          application/json:
            schema:
              $ref: '../../components/schemas/error.yml#/ProblemDetails'
      '401':
        description: Invalid or missing credentials
        content:
          application/json:
            schema:
              $ref: '../../components/schemas/error.yml#/ProblemDetails'
      '403':
        description: Permission denied
        content:
          application/json:
            schema:
              $ref: '../../components/schemas/error.yml#/ProblemDetails'
      '404':
        description: Project or service account not found
        content:
          application/json:
            schema:
              $ref: '../../components/schemas/error.yml#/ProblemDetails'
      '500':
        $ref: '../../components/responses/errors.yml#/InternalServerError'
      '503':
        $ref: '../../components/responses/errors.yml#/ServiceUnavailable'

  patch:
    operationId: updateServiceAccount
    summary: Update a service account
    description: |
      Updates an existing service account.
      Only provided fields are updated; omitted fields retain their current values.
    tags:
      - Service Accounts
    security:
      - ApiKeyAuth: []
        ServiceAccountAuth: []
    parameters:
      - name: projectId
        in: path
        description: The project ID that owns the service account
        required: true
        schema:
          type: string
          pattern: '^[a-z][a-z0-9-]{4,28}[a-z0-9]$'
      - name: id
        in: path
        description: The service account ID
        required: true
        schema:
          type: string
          pattern: '^[a-z][a-z0-9-]{2,126}[a-z0-9]$'
    requestBody:
      description: Service account update parameters
      required: true
      content:
        application/json:
          schema:
            $ref: '../../components/schemas/admin/service_account.yml#/UpdateServiceAccountRequest'
    responses:
      '200':
        description: Service account updated
        content:
          application/json:
            schema:
              $ref: '../../components/schemas/admin/service_account.yml#/UpdateServiceAccountResponse'
      '400':
        description: Invalid projectId, service account ID, or field format
        content:
          application/json:
            schema:
              $ref: '../../components/schemas/error.yml#/ProblemDetails'
      '401':
        description: Invalid or missing credentials
        content:
          application/json:
            schema:
              $ref: '../../components/schemas/error.yml#/ProblemDetails'
      '403':
        description: Permission denied
        content:
          application/json:
            schema:
              $ref: '../../components/schemas/error.yml#/ProblemDetails'
      '404':
        description: Project or service account not found
        content:
          application/json:
            schema:
              $ref: '../../components/schemas/error.yml#/ProblemDetails'
      '500':
        $ref: '../../components/responses/errors.yml#/InternalServerError'
      '503':
        $ref: '../../components/responses/errors.yml#/ServiceUnavailable'

  delete:
    operationId: deleteServiceAccount
    summary: Delete a service account
    description: |
      Permanently deletes a service account.
      This operation is irreversible. All keys associated with the
      service account will also be deleted.
    tags:
      - Service Accounts
    security:
      - ApiKeyAuth: []
        ServiceAccountAuth: []
    parameters:
      - name: projectId
        in: path
        description: The project ID that owns the service account
        required: true
        schema:
          type: string
          pattern: '^[a-z][a-z0-9-]{4,28}[a-z0-9]$'
      - name: id
        in: path
        description: The service account ID
        required: true
        schema:
          type: string
          pattern: '^[a-z][a-z0-9-]{2,126}[a-z0-9]$'
    responses:
      '204':
        description: Service account permanently deleted
      '400':
        description: Invalid projectId or service account ID format
        content:
          application/json:
            schema:
              $ref: '../../components/schemas/error.yml#/ProblemDetails'
      '401':
        description: Invalid or missing credentials
        content:
          application/json:
            schema:
              $ref: '../../components/schemas/error.yml#/ProblemDetails'
      '403':
        description: Permission denied
        content:
          application/json:
            schema:
              $ref: '../../components/schemas/error.yml#/ProblemDetails'
      '404':
        description: Project or service account not found
        content:
          application/json:
            schema:
              $ref: '../../components/schemas/error.yml#/ProblemDetails'
      '500':
        $ref: '../../components/responses/errors.yml#/InternalServerError'
      '503':
        $ref: '../../components/responses/errors.yml#/ServiceUnavailable'

# =============================================================================
# Service Account Search
# =============================================================================

searchServiceAccounts:
  post:
    operationId: searchServiceAccounts
    summary: Search service accounts
    description: |
      Searches for service accounts within a project.
      Supports full-text search across multiple fields and filtering.
    tags:
      - Service Accounts
    security:
      - ApiKeyAuth: []
        ServiceAccountAuth: []
    parameters:
      - name: projectId
        in: path
        description: The project ID to search service accounts in
        required: true
        schema:
          type: string
          pattern: '^[a-z][a-z0-9-]{4,28}[a-z0-9]$'
    requestBody:
      description: Search parameters
      required: true
      content:
        application/json:
          schema:
            $ref: '../../components/schemas/admin/service_account.yml#/SearchServiceAccountsRequest'
    responses:
      '200':
        description: Search results
        content:
          application/json:
            schema:
              $ref: '../../components/schemas/admin/service_account.yml#/SearchServiceAccountsResponse'
      '400':
        description: Invalid search parameters
        content:
          application/json:
            schema:
              $ref: '../../components/schemas/error.yml#/ProblemDetails'
      '401':
        description: Invalid or missing credentials
        content:
          application/json:
            schema:
              $ref: '../../components/schemas/error.yml#/ProblemDetails'
      '403':
        description: Permission denied
        content:
          application/json:
            schema:
              $ref: '../../components/schemas/error.yml#/ProblemDetails'
      '404':
        description: Project not found
        content:
          application/json:
            schema:
              $ref: '../../components/schemas/error.yml#/ProblemDetails'
      '500':
        $ref: '../../components/responses/errors.yml#/InternalServerError'
      '503':
        $ref: '../../components/responses/errors.yml#/ServiceUnavailable'

# =============================================================================
# Service Account Key Collection
# =============================================================================

serviceAccountKeys:
  get:
    operationId: listServiceAccountKeys
    summary: List service account keys
    description: |
      Lists all keys for a service account.
      Note: Private key data is never returned after initial generation.
    tags:
      - Service Accounts
    security:
      - ApiKeyAuth: []
        ServiceAccountAuth: []
    parameters:
      - name: projectId
        in: path
        description: The project ID that owns the service account
        required: true
        schema:
          type: string
          pattern: '^[a-z][a-z0-9-]{4,28}[a-z0-9]$'
      - name: id
        in: path
        description: The service account ID
        required: true
        schema:
          type: string
          pattern: '^[a-z][a-z0-9-]{2,126}[a-z0-9]$'
    responses:
      '200':
        description: List of keys
        content:
          application/json:
            schema:
              $ref: '../../components/schemas/admin/service_account.yml#/ListServiceAccountKeysResponse'
      '400':
        description: Invalid projectId or service account ID format
        content:
          application/json:
            schema:
              $ref: '../../components/schemas/error.yml#/ProblemDetails'
      '401':
        description: Invalid or missing credentials
        content:
          application/json:
            schema:
              $ref: '../../components/schemas/error.yml#/ProblemDetails'
      '403':
        description: Permission denied
        content:
          application/json:
            schema:
              $ref: '../../components/schemas/error.yml#/ProblemDetails'
      '404':
        description: Project or service account not found
        content:
          application/json:
            schema:
              $ref: '../../components/schemas/error.yml#/ProblemDetails'
      '500':
        $ref: '../../components/responses/errors.yml#/InternalServerError'
      '503':
        $ref: '../../components/responses/errors.yml#/ServiceUnavailable'

  post:
    operationId: generateServiceAccountKey
    summary: Generate a service account key
    description: |
      Generates a new key for a service account.
      The private key data is only returned once in the response and cannot
      be retrieved again. Store the key securely.
    tags:
      - Service Accounts
    security:
      - ApiKeyAuth: []
        ServiceAccountAuth: []
    parameters:
      - name: projectId
        in: path
        description: The project ID that owns the service account
        required: true
        schema:
          type: string
          pattern: '^[a-z][a-z0-9-]{4,28}[a-z0-9]$'
      - name: id
        in: path
        description: The service account ID
        required: true
        schema:
          type: string
          pattern: '^[a-z][a-z0-9-]{2,126}[a-z0-9]$'
    requestBody:
      description: Key generation parameters
      required: false
      content:
        application/json:
          schema:
            $ref: '../../components/schemas/admin/service_account.yml#/GenerateKeyRequest'
    responses:
      '201':
        description: Key generated successfully
        content:
          application/json:
            schema:
              $ref: '../../components/schemas/admin/service_account.yml#/GenerateKeyResponse'
      '400':
        description: Invalid projectId, service account ID, or key parameters
        content:
          application/json:
            schema:
              $ref: '../../components/schemas/error.yml#/ProblemDetails'
      '401':
        description: Invalid or missing credentials
        content:
          application/json:
            schema:
              $ref: '../../components/schemas/error.yml#/ProblemDetails'
      '403':
        description: Permission denied
        content:
          application/json:
            schema:
              $ref: '../../components/schemas/error.yml#/ProblemDetails'
      '404':
        description: Project or service account not found
        content:
          application/json:
            schema:
              $ref: '../../components/schemas/error.yml#/ProblemDetails'
      '500':
        $ref: '../../components/responses/errors.yml#/InternalServerError'
      '503':
        $ref: '../../components/responses/errors.yml#/ServiceUnavailable'

# =============================================================================
# Individual Service Account Key Endpoints
# =============================================================================

serviceAccountKeyById:
  get:
    operationId: getServiceAccountKey
    summary: Get a service account key
    description: |
      Retrieves a specific key by ID.
      Note: Private key data is never returned after initial generation.
    tags:
      - Service Accounts
    security:
      - ApiKeyAuth: []
        ServiceAccountAuth: []
    parameters:
      - name: projectId
        in: path
        description: The project ID that owns the service account
        required: true
        schema:
          type: string
          pattern: '^[a-z][a-z0-9-]{4,28}[a-z0-9]$'
      - name: id
        in: path
        description: The service account ID
        required: true
        schema:
          type: string
          pattern: '^[a-z][a-z0-9-]{2,126}[a-z0-9]$'
      - name: keyId
        in: path
        description: The key ID
        required: true
        schema:
          type: string
          minLength: 1
    responses:
      '200':
        description: Key details
        content:
          application/json:
            schema:
              $ref: '../../components/schemas/admin/service_account.yml#/GetServiceAccountKeyResponse'
      '400':
        description: Invalid parameters
        content:
          application/json:
            schema:
              $ref: '../../components/schemas/error.yml#/ProblemDetails'
      '401':
        description: Invalid or missing credentials
        content:
          application/json:
            schema:
              $ref: '../../components/schemas/error.yml#/ProblemDetails'
      '403':
        description: Permission denied
        content:
          application/json:
            schema:
              $ref: '../../components/schemas/error.yml#/ProblemDetails'
      '404':
        description: Project, service account, or key not found
        content:
          application/json:
            schema:
              $ref: '../../components/schemas/error.yml#/ProblemDetails'
      '500':
        $ref: '../../components/responses/errors.yml#/InternalServerError'
      '503':
        $ref: '../../components/responses/errors.yml#/ServiceUnavailable'

  delete:
    operationId: deleteServiceAccountKey
    summary: Delete a service account key
    description: |
      Permanently deletes a service account key.
      This operation is irreversible.
    tags:
      - Service Accounts
    security:
      - ApiKeyAuth: []
        ServiceAccountAuth: []
    parameters:
      - name: projectId
        in: path
        description: The project ID that owns the service account
        required: true
        schema:
          type: string
          pattern: '^[a-z][a-z0-9-]{4,28}[a-z0-9]$'
      - name: id
        in: path
        description: The service account ID
        required: true
        schema:
          type: string
          pattern: '^[a-z][a-z0-9-]{2,126}[a-z0-9]$'
      - name: keyId
        in: path
        description: The key ID
        required: true
        schema:
          type: string
          minLength: 1
    responses:
      '204':
        description: Key permanently deleted
      '400':
        description: Invalid parameters
        content:
          application/json:
            schema:
              $ref: '../../components/schemas/error.yml#/ProblemDetails'
      '401':
        description: Invalid or missing credentials
        content:
          application/json:
            schema:
              $ref: '../../components/schemas/error.yml#/ProblemDetails'
      '403':
        description: Permission denied
        content:
          application/json:
            schema:
              $ref: '../../components/schemas/error.yml#/ProblemDetails'
      '404':
        description: Project, service account, or key not found
        content:
          application/json:
            schema:
              $ref: '../../components/schemas/error.yml#/ProblemDetails'
      '500':
        $ref: '../../components/responses/errors.yml#/InternalServerError'
      '503':
        $ref: '../../components/responses/errors.yml#/ServiceUnavailable'

# =============================================================================
# Service Account Key Enable/Disable
# =============================================================================

disableServiceAccountKey:
  post:
    operationId: disableServiceAccountKey
    summary: Disable a service account key
    description: |
      Disables a service account key without deleting it.
      Disabled keys cannot be used for authentication.

      This operation is idempotent. Calling disable on an already-disabled key
      returns 200 OK with the current key state.
    tags:
      - Service Accounts
    security:
      - ApiKeyAuth: []
        ServiceAccountAuth: []
    parameters:
      - name: projectId
        in: path
        description: The project ID that owns the service account
        required: true
        schema:
          type: string
          pattern: '^[a-z][a-z0-9-]{4,28}[a-z0-9]$'
      - name: id
        in: path
        description: The service account ID
        required: true
        schema:
          type: string
          pattern: '^[a-z][a-z0-9-]{2,126}[a-z0-9]$'
      - name: keyId
        in: path
        description: The key ID
        required: true
        schema:
          type: string
          minLength: 1
    responses:
      '200':
        description: Key disabled
        content:
          application/json:
            schema:
              $ref: '../../components/schemas/admin/service_account.yml#/DisableServiceAccountKeyResponse'
      '400':
        description: Invalid parameters
        content:
          application/json:
            schema:
              $ref: '../../components/schemas/error.yml#/ProblemDetails'
      '401':
        description: Invalid or missing credentials
        content:
          application/json:
            schema:
              $ref: '../../components/schemas/error.yml#/ProblemDetails'
      '403':
        description: Permission denied
        content:
          application/json:
            schema:
              $ref: '../../components/schemas/error.yml#/ProblemDetails'
      '404':
        description: Project, service account, or key not found
        content:
          application/json:
            schema:
              $ref: '../../components/schemas/error.yml#/ProblemDetails'
      '500':
        $ref: '../../components/responses/errors.yml#/InternalServerError'
      '503':
        $ref: '../../components/responses/errors.yml#/ServiceUnavailable'

enableServiceAccountKey:
  post:
    operationId: enableServiceAccountKey
    summary: Enable a service account key
    description: |
      Re-enables a previously disabled service account key.
    tags:
      - Service Accounts
    security:
      - ApiKeyAuth: []
        ServiceAccountAuth: []
    parameters:
      - name: projectId
        in: path
        description: The project ID that owns the service account
        required: true
        schema:
          type: string
          pattern: '^[a-z][a-z0-9-]{4,28}[a-z0-9]$'
      - name: id
        in: path
        description: The service account ID
        required: true
        schema:
          type: string
          pattern: '^[a-z][a-z0-9-]{2,126}[a-z0-9]$'
      - name: keyId
        in: path
        description: The key ID
        required: true
        schema:
          type: string
          minLength: 1
    responses:
      '200':
        description: Key enabled
        content:
          application/json:
            schema:
              $ref: '../../components/schemas/admin/service_account.yml#/EnableServiceAccountKeyResponse'
      '400':
        description: Invalid parameters
        content:
          application/json:
            schema:
              $ref: '../../components/schemas/error.yml#/ProblemDetails'
      '401':
        description: Invalid or missing credentials
        content:
          application/json:
            schema:
              $ref: '../../components/schemas/error.yml#/ProblemDetails'
      '403':
        description: Permission denied
        content:
          application/json:
            schema:
              $ref: '../../components/schemas/error.yml#/ProblemDetails'
      '404':
        description: Project, service account, or key not found
        content:
          application/json:
            schema:
              $ref: '../../components/schemas/error.yml#/ProblemDetails'
      '500':
        $ref: '../../components/responses/errors.yml#/InternalServerError'
      '503':
        $ref: '../../components/responses/errors.yml#/ServiceUnavailable'
