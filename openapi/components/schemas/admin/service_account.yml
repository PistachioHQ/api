# Service Account schemas for Admin API

ServiceAccount:
  type: object
  description: |
    A service account for server-to-server authentication.
    Service accounts use key-based authentication and are used for
    administrative operations and backend integrations.
  required:
    - name
    - serviceAccountId
    - displayName
    - disabled
    - createdAt
    - updatedAt
  properties:
    name:
      type: string
      description: |
        Resource name in the format:
        "projects/{project_id}/serviceAccounts/{service_account_id}"
      example: projects/my-project/serviceAccounts/sa-backend-service
    serviceAccountId:
      type: string
      description: |
        Unique service account identifier within the project.
        System-generated if not provided. Max 128 characters.
      pattern: '^[a-z][a-z0-9-]{2,126}[a-z0-9]$'
      maxLength: 128
      example: sa-backend-service
    pistachioId:
      type: string
      description: |
        Internal service account identifier.
        16 bytes encoded as 32 hex characters ending in '03'.
      pattern: '^[a-fA-F0-9]{30}03$'
      example: a1b2c3d4e5f6789012345678901234503
    displayName:
      type: string
      description: Human-readable display name. Max 256 characters.
      maxLength: 256
      example: Backend Service Account
    description:
      type:
        - string
        - 'null'
      description: Optional description of the service account's purpose.
      maxLength: 1000
      example: Service account for backend API integrations
    email:
      type: string
      format: email
      description: |
        Auto-generated email address for the service account.
        Format: {service_account_id}@{project_id}.pistachiohq.iam.gserviceaccount.com
      example: sa-backend-service@my-project.pistachiohq.iam.gserviceaccount.com
    disabled:
      type: boolean
      description: |
        Whether the service account is disabled.
        Disabled service accounts cannot authenticate.
      default: false
      example: false
    createdAt:
      type: string
      format: date-time
      description: Timestamp when the service account was created.
      example: "2024-01-15T10:30:00Z"
    updatedAt:
      type: string
      format: date-time
      description: Timestamp when the service account was last updated.
      example: "2024-01-15T10:30:00Z"

ServiceAccountKey:
  type: object
  description: |
    A key for service account authentication.
    Keys are used to generate JWTs for authenticating as the service account.
  required:
    - name
    - keyId
    - keyAlgorithm
    - validAfterTime
  properties:
    name:
      type: string
      description: |
        Resource name in the format:
        "projects/{project_id}/serviceAccounts/{service_account_id}/keys/{key_id}"
      example: projects/my-project/serviceAccounts/sa-backend-service/keys/key-abc123
    keyId:
      type: string
      description: Unique key identifier.
      example: key-abc123
    keyAlgorithm:
      type: string
      description: The algorithm used for the key pair.
      enum:
        - RSA_2048
        - RSA_4096
        - EC_P256
        - EC_P384
        - ED25519
      example: RSA_2048
    keyOrigin:
      type: string
      description: How the key was created.
      enum:
        - SYSTEM_PROVIDED
        - USER_PROVIDED
      example: SYSTEM_PROVIDED
    validAfterTime:
      type: string
      format: date-time
      description: The key becomes valid at this time.
      example: "2024-01-15T10:30:00Z"
    validBeforeTime:
      type:
        - string
        - 'null'
      format: date-time
      description: The key expires at this time. Null means no expiration.
      example: "2025-01-15T10:30:00Z"
    disabled:
      type: boolean
      description: Whether the key is disabled.
      default: false
      example: false

# Request/Response schemas

ListServiceAccountsResponse:
  type: object
  description: Response containing a page of service accounts.
  properties:
    serviceAccounts:
      type: array
      description: The list of service accounts.
      items:
        $ref: '#/ServiceAccount'
    pagination:
      $ref: '../../schemas/common.yml#/Pagination'

GetServiceAccountResponse:
  type: object
  description: Response containing the requested service account.
  properties:
    serviceAccount:
      $ref: '#/ServiceAccount'

CreateServiceAccountRequest:
  type: object
  description: Request body for creating a service account.
  properties:
    serviceAccountId:
      type: string
      description: |
        Desired service account ID. If not provided, one will be generated.
        Must be 4-128 characters, lowercase alphanumeric with hyphens.
      pattern: '^$|^[a-z][a-z0-9-]{2,126}[a-z0-9]$'
      maxLength: 128
      example: sa-backend-service
    displayName:
      type: string
      description: Human-readable display name. Required.
      maxLength: 256
      example: Backend Service Account
    description:
      type: string
      description: Optional description of the service account's purpose.
      maxLength: 1000
      example: Service account for backend API integrations
  required:
    - displayName

CreateServiceAccountResponse:
  type: object
  description: Response containing the newly created service account.
  properties:
    serviceAccount:
      $ref: '#/ServiceAccount'

UpdateServiceAccountRequest:
  type: object
  description: Request body for updating a service account.
  properties:
    displayName:
      type: string
      description: New display name.
      maxLength: 256
      example: Updated Backend Service
    description:
      type:
        - string
        - 'null'
      description: New description. Set to null to clear.
      maxLength: 1000
      example: Updated description
    disabled:
      type: boolean
      description: Whether to disable the service account.
      example: false

UpdateServiceAccountResponse:
  type: object
  description: Response containing the updated service account.
  properties:
    serviceAccount:
      $ref: '#/ServiceAccount'

GenerateKeyRequest:
  type: object
  description: Request body for generating a new service account key.
  properties:
    keyAlgorithm:
      type: string
      description: |
        The algorithm for the key pair. Defaults to RSA_2048.
        ED25519 is recommended for new keys due to smaller signatures and faster verification.
      enum:
        - RSA_2048
        - RSA_4096
        - EC_P256
        - EC_P384
        - ED25519
      default: RSA_2048
      example: RSA_2048
    validBeforeTime:
      type: string
      format: date-time
      description: Optional expiration time for the key.
      example: "2025-01-15T10:30:00Z"

GenerateKeyResponse:
  type: object
  description: |
    Response containing the newly generated key.
    IMPORTANT: The privateKeyData is only returned once and cannot be retrieved again.
  properties:
    key:
      $ref: '#/ServiceAccountKey'
    privateKeyData:
      type: string
      format: byte
      description: |
        Base64-encoded private key data in PKCS#8 format.
        This is only returned once at key creation time.
      example: LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCi4uLgo=
    keyFileJson:
      type: string
      description: |
        JSON key file contents for SDK authentication.
        Contains the private key and service account metadata.
        This is only returned once at key creation time.
      example: '{"type": "service_account", ...}'

# =============================================================================
# Search Service Accounts
# =============================================================================

SearchServiceAccountsRequest:
  type: object
  description: Request body for searching service accounts.
  properties:
    query:
      type: string
      description: |
        Search query string. Searches across service_account_id,
        display_name, email, and description fields.
      maxLength: 500
      example: backend
    filter:
      type: string
      description: |
        Filter expression to narrow results. Supports field-level filtering
        like "disabled=true" or "created_at>2024-01-01".
      maxLength: 1000
      example: "disabled=false"
    pageSize:
      type: integer
      format: int32
      description: Number of results to return per page.
      minimum: 1
      maximum: 100
      default: 20
      example: 20
    cursor:
      type: string
      description: Cursor for pagination. Use "*" for first page.
      example: "*"
    sort:
      type: string
      description: |
        Sort specification. Format: "field:DIRECTION" (e.g., "created_at:DESC").
        Multiple fields separated by commas.
      example: "created_at:DESC"

SearchServiceAccountsResponse:
  type: object
  description: Response containing service accounts matching the search query.
  properties:
    serviceAccounts:
      type: array
      description: The list of service accounts matching the search.
      items:
        $ref: '#/ServiceAccount'
    pagination:
      $ref: '../../schemas/common.yml#/Pagination'

# =============================================================================
# Service Account Key Operations
# =============================================================================

ListServiceAccountKeysResponse:
  type: object
  description: Response containing the service account's keys.
  properties:
    keys:
      type: array
      description: The list of keys for the service account.
      items:
        $ref: '#/ServiceAccountKey'

GetServiceAccountKeyResponse:
  type: object
  description: Response containing the requested key.
  properties:
    key:
      $ref: '#/ServiceAccountKey'

DisableServiceAccountKeyResponse:
  type: object
  description: Response containing the disabled key.
  properties:
    key:
      $ref: '#/ServiceAccountKey'

EnableServiceAccountKeyResponse:
  type: object
  description: Response containing the re-enabled key.
  properties:
    key:
      $ref: '#/ServiceAccountKey'
